function buildForm(form){if(SqPaymentForm.isSupportedBrowser()){form.build();form.recalculateSize();}}
var isCalled=false;var gaEnabled=!!(window.ga);if(gaEnabled){ga('require','ecommerce');}
function requestCardNonce(event){event.preventDefault();if(!isCalled){paymentForm.requestCardNonce();}}
var paymentForm=new SqPaymentForm({applicationId:applicationId,locationId:locationId,inputClass:'sq-input',autoBuild:false,inputStyles:[{fontSize:'18px',fontFamily:'Helvetica Neue',padding:'0',color:'#373F4A',backgroundColor:'transparent',lineHeight:'20px',placeholderColor:'#CCC',_webkitFontSmoothing:'antialiased',_mozOsxFontSmoothing:'grayscale'}],applePay:false,masterpass:false,cardNumber:{elementId:'sq-card-number',placeholder:'• • • •  • • • •  • • • •  • • • •'},cvv:{elementId:'sq-cvv',placeholder:'CVV'},expirationDate:{elementId:'sq-expiration-date',placeholder:'MM/YY'},postalCode:{elementId:'sq-postal-code',placeholder:'12345'},callbacks:{createPaymentRequest:function(){return{requestShippingAddress:false,requestBillingInfo:true,currencyCode:"USD",countryCode:"US",total:{label:"MERCHANT NAME",amount:"100",pending:false},lineItems:[{label:"Subtotal",amount:"100",pending:false}]}},cardNonceResponseReceived:function(errors,nonce,cardData){isCalled=true;const alert=document.getElementById('notification');const formFields={donorName:document.getElementById('donorName'),business:document.getElementById('business'),email:document.getElementById('email'),addr1:document.getElementById('addr1'),addr2:document.getElementById('addr2'),city:document.getElementById('city'),state:document.getElementById('state'),zip:document.getElementById('zip'),amount:document.getElementById('amount-other'),amountDropdown:document.getElementById('amount'),viptix:document.getElementById('viptix'),nonce:document.getElementById('card-nonce')};formFields.nonce.value=nonce;fetch('/checkout',{method:'post',body:JSON.stringify({donorName:formFields.donorName.value,business:formFields.business.value,email:formFields.email.value,addr1:formFields.addr1.value,addr2:formFields.addr2.value,city:formFields.city.value,state:formFields.state.value,zip:formFields.zip.value,amount:(formFields.amountDropdown.value==='other')?formFields.amount.value:formFields.amountDropdown.value,viptix:formFields.viptix.value,nonce:formFields.nonce.value})}).then(data=>data.json()).then(data=>{if(gaEnabled){const options={'id':data.transaction.id,'affiliation':'Move It Raleigh Website','revenue':(data.transaction.tenders[0].amount_money.amount/100).toFixed(2),'currency':'USD'};ga('ecommerce:addTransaction',options);ga('ecommerce:send');}
donorName.value=business.value=email.value=addr1.value=addr2.value=city.value=state.value=zip.value=amount.value=amountDropdown.value=viptix.value='';window.location.replace('/sponsor/thankyou');}).catch(error=>{isCalled=false;alert.innerHTML='Something went wrong. Please try again.';alert.classList.add('alert-danger');alert.classList.add('fade-in-out');alert.classList.remove('hidden');});},unsupportedBrowserDetected:function(){},inputEventReceived:function(inputEvent){switch(inputEvent.eventType){case 'focusClassAdded':break;case 'focusClassRemoved':break;case 'errorClassAdded':document.getElementById("error").innerHTML="Please fix card information errors before continuing.";break;case 'errorClassRemoved':document.getElementById("error").style.display="none";break;case 'cardBrandChanged':break;case 'postalCodeChanged':break;}},paymentFormLoaded:function(){}}});